--**************************************************************
---***********GOING TO PARTIONING T_GENERALLOG *****************

---CURRENT SIZE  20.1474609 G
---SELECT COUNT(1) FROM  FCB.T_GENERALLOG   99,723,969 rows

SELECT SEGMENT_NAME,
       SEGMENT_TYPE,
       PARTITION_NAME,
       BYTES / (1024 * 1024*1024) SIZEOFTBL
  FROM DBA_SEGMENTS
 WHERE SEGMENT_NAME = 'T_GENERALLOG'


--- 1
--- CREATE  PARTITION INTERIM TABLE OF  T_GENERALLOG 

CREATE TABLE FCB.T_GENERALLOG_TP
(
  ID                 NUMBER(19),
  C_VERSION          NUMBER(10),
  C_ACTIVE           NUMBER(1),
  C_DEBTORAMOUNT     NUMBER(38,4),
  C_MACHINEIP        VARCHAR2(255 CHAR),
  C_MANUALID         VARCHAR2(255 CHAR),
  C_USERLASTNAME     VARCHAR2(255 CHAR),
  C_TIME             VARCHAR2(255 CHAR),
  C_CREDITORAMOUNT   NUMBER(38,4),
  C_CURRENCYCODE     VARCHAR2(255 CHAR),
  C_DATE             VARCHAR2(255 CHAR),
  C_USERFIRSTNAME    VARCHAR2(255 CHAR),
  C_USERCODE         VARCHAR2(255 CHAR),
  C_BRANCHCODE       VARCHAR2(255 CHAR),
  C_CURRENCYNAME     VARCHAR2(255 CHAR),
  C_DESCRIPTION      VARCHAR2(255 CHAR),
  C_TRANSACTIONCODE  VARCHAR2(255 CHAR),
  C_ENABLE           NUMBER(1)
) TABLESPACE FCB_TBL 
   PARTITION BY RANGE ( C_DATE)
(
 PARTITION GENERALLOG_1387_11_01 VALUES LESS THAN ('1387/11/01'),
 PARTITION GENERALLOG_1387_12_01 VALUES LESS THAN ('1387/12/01'),
 PARTITION GENERALLOG_1388_01_01 VALUES LESS THAN ('1388/01/01'),
 PARTITION GENERALLOG_1388_02_01 VALUES LESS THAN ('1388/02/01'),
 PARTITION GENERALLOG_1388_03_01 VALUES LESS THAN ('1388/03/01'),
 PARTITION GENERALLOG_1388_04_01 VALUES LESS THAN ('1388/04/01'),
 PARTITION GENERALLOG_1388_05_01 VALUES LESS THAN ('1388/05/01'),
 PARTITION GENERALLOG_1388_06_01 VALUES LESS THAN ('1388/06/01'),
 PARTITION GENERALLOG_1388_07_01 VALUES LESS THAN ('1388/07/01'),
 PARTITION GENERALLOG_1388_08_01 VALUES LESS THAN ('1388/08/01'),
 PARTITION GENERALLOG_1388_09_01 VALUES LESS THAN ('1388/09/01'),
 PARTITION GENERALLOG_1388_10_01 VALUES LESS THAN ('1388/10/01'),
 PARTITION GENERALLOG_1388_11_01 VALUES LESS THAN ('1388/11/01'),
 PARTITION GENERALLOG_1388_12_01 VALUES LESS THAN ('1388/12/01'),
 PARTITION GENERALLOG_1389_01_01 VALUES LESS THAN ('1389/01/01'),
 PARTITION GENERALLOG_1389_02_01 VALUES LESS THAN ('1389/02/01'),
 PARTITION GENERALLOG_1389_03_01 VALUES LESS THAN ('1389/03/01'),
 PARTITION GENERALLOG_1389_04_01 VALUES LESS THAN ('1389/04/01'),
 PARTITION GENERALLOG_1389_05_01 VALUES LESS THAN ('1389/05/01'),
 PARTITION GENERALLOG_1389_06_01 VALUES LESS THAN ('1389/06/01'),
 PARTITION GENERALLOG_1389_07_01 VALUES LESS THAN ('1389/07/01'),
 PARTITION GENERALLOG_1389_08_01 VALUES LESS THAN ('1389/08/01'),
 PARTITION GENERALLOG_1389_09_01 VALUES LESS THAN ('1389/09/01'),
 PARTITION GENERALLOG_1389_10_01 VALUES LESS THAN ('1389/10/01'),
 PARTITION GENERALLOG_1389_11_01 VALUES LESS THAN ('1389/11/01'),
 PARTITION GENERALLOG_1389_12_01 VALUES LESS THAN ('1389/12/01'),
 PARTITION GENERALLOG_1390_01_01 VALUES LESS THAN ('1390/01/01'),
 PARTITION GENERALLOG_1390_02_01 VALUES LESS THAN ('1390/02/01'),
 PARTITION GENERALLOG_1390_03_01 VALUES LESS THAN ('1390/03/01'),
 PARTITION GENERALLOG_1390_04_01 VALUES LESS THAN ('1390/04/01'),
 PARTITION GENERALLOG_1390_05_01 VALUES LESS THAN ('1390/05/01'),
 PARTITION GENERALLOG_1390_06_01 VALUES LESS THAN ('1390/06/01'),
 PARTITION GENERALLOG_1390_07_01 VALUES LESS THAN ('1390/07/01'),
 PARTITION GENERALLOG_1390_08_01 VALUES LESS THAN ('1390/08/01'),
 PARTITION GENERALLOG_1390_09_01 VALUES LESS THAN ('1390/09/01'),
 PARTITION GENERALLOG_1390_10_01 VALUES LESS THAN ('1390/10/01'),
 PARTITION GENERALLOG_1390_11_01 VALUES LESS THAN ('1390/11/01'),
 PARTITION GENERALLOG_1390_12_01 VALUES LESS THAN ('1390/12/01'),
 PARTITION GENERALLOG_1391_01_01 VALUES LESS THAN ('1391/01/01'),
 PARTITION GENERALLOG_1391_02_01 VALUES LESS THAN ('1391/02/01'),
 PARTITION GENERALLOG_1391_03_01 VALUES LESS THAN ('1391/03/01'),
 PARTITION GENERALLOG_1391_04_01 VALUES LESS THAN ('1391/04/01'),
 PARTITION GENERALLOG_1391_05_01 VALUES LESS THAN ('1391/05/01'),
 PARTITION GENERALLOG_1391_06_01 VALUES LESS THAN ('1391/06/01'),
 PARTITION GENERALLOG_1391_07_01 VALUES LESS THAN ('1391/07/01'),
 PARTITION GENERALLOG_1391_08_01 VALUES LESS THAN ('1391/08/01'),
 PARTITION GENERALLOG_1391_09_01 VALUES LESS THAN ('1391/09/01'),
 PARTITION GENERALLOG_1391_10_01 VALUES LESS THAN ('1391/10/01'),
 PARTITION GENERALLOG_1391_11_01 VALUES LESS THAN ('1391/11/01'),
 PARTITION GENERALLOG_1391_12_01 VALUES LESS THAN ('1391/12/01'),
 PARTITION GENERALLOG_1392_01_01 VALUES LESS THAN ('1392/01/01'),
 PARTITION GENERALLOG_1392_02_01 VALUES LESS THAN ('1392/02/01'),
 PARTITION GENERALLOG_1392_03_01 VALUES LESS THAN ('1392/03/01'),
 PARTITION GENERALLOG_1392_04_01 VALUES LESS THAN ('1392/04/01'),
 PARTITION GENERALLOG_1392_05_01 VALUES LESS THAN ('1392/05/01'),
 PARTITION GENERALLOG_1392_06_01 VALUES LESS THAN ('1392/06/01'),
 PARTITION GENERALLOG_1392_07_01 VALUES LESS THAN ('1392/07/01'),
 PARTITION GENERALLOG_1392_08_01 VALUES LESS THAN ('1392/08/01'),
 PARTITION GENERALLOG_1392_09_01 VALUES LESS THAN ('1392/09/01'),
 PARTITION GENERALLOG_1392_10_01 VALUES LESS THAN ('1392/10/01'),
 PARTITION GENERALLOG_1392_11_01 VALUES LESS THAN ('1392/11/01'),
 PARTITION GENERALLOG_1392_12_01 VALUES LESS THAN ('1392/12/01'),
 PARTITION GENERALLOG_1393_01_01 VALUES LESS THAN ('1393/01/01'),
 PARTITION GENERALLOG_1393_02_01 VALUES LESS THAN ('1393/02/01'),
 PARTITION GENERALLOG_1393_03_01 VALUES LESS THAN ('1393/03/01'),
 PARTITION GENERALLOG_1393_04_01 VALUES LESS THAN ('1393/04/01'),
 PARTITION GENERALLOG_1393_05_01 VALUES LESS THAN ('1393/05/01'),
 PARTITION GENERALLOG_1393_06_01 VALUES LESS THAN ('1393/06/01'),
 PARTITION GENERALLOG_1393_07_01 VALUES LESS THAN ('1393/07/01'),
 PARTITION GENERALLOG_1393_08_01 VALUES LESS THAN ('1393/08/01'),
 PARTITION GENERALLOG_1393_09_01 VALUES LESS THAN ('1393/09/01'),
 PARTITION GENERALLOG_1393_10_01 VALUES LESS THAN ('1393/10/01'),
 PARTITION GENERALLOG_1393_11_01 VALUES LESS THAN ('1393/11/01'),
 PARTITION GENERALLOG_1393_12_01 VALUES LESS THAN ('1393/12/01'),
 PARTITION GENERALLOG_1394_01_01 VALUES LESS THAN (MAXVALUE))


---2
---CHECK THE REDEFINITION IS POSSIBLE 

EXEC Dbms_Redefinition.Can_Redef_Table('FCB', 'T_GENERALLOG');


--3
----START THE REDEFINTION    ---->20 MINUTE 

BEGIN
  DBMS_REDEFINITION.start_redef_table(
    uname      => 'FCB',        
    orig_table => 'T_GENERALLOG',
    int_table  => 'T_GENERALLOG_TP');
END;

/*
BEGIN
  DBMS_REDEFINITION.start_redef_table(
    uname      => 'FCB',        
    orig_table => 'T_DOCUMENT',
    int_table  => 'T_DOCUMENT_IT',
    col_mapping   => ' ID ID,
                       C_VERSION C_VERSION, 
                       C_ACTIVE C_ACTIVE,
                       C_MANUALID C_MANUALID ,
                       C_SHEETNUMBER C_SHEETNUMBER,
                       C_EFFECTIVEDATE C_EFFECTIVEDATE,
                       C_COMMENT C_COMMENT,
                       C_DATE C_DATE,
                       C_EQUIVALENT C_EQUIVALENT,
                       C_DOCUMENTNUMBER C_DOCUMENTNUMBER,
                       C_ISSUANCEDATE C_ISSUANCEDATE,
                       C_TRANSACTIONNUMBER C_TRANSACTIONNUMBER,
                       C_ENDOFYEARDOCUMENT C_ENDOFYEARDOCUMENT,
                       C_SERIAL C_SERIAL,
                       C_ENABLE C_ENABLE,
                       C_BRANCHBANKBOOK C_BRANCHBANKBOOK,
                       C_EQUIVALENTDOCUMENT C_EQUIVALENTDOCUMENT,
                       C_BANKBOOK C_BANKBOOK,  
                       C_CURRENCY C_CURRENCY,
                       C_STATUS C_STATUS,
                       C_RELATEDBRANCH C_RELATEDBRANCH,
                       C_ISSUER C_ISSUER,
                       C_CONFIRMER C_CONFIRMER,
                       C_SYSTEMOPERATION C_SYSTEMOPERATION,               
                       C_SUBSYSTEM C_SUBSYSTEM,
                       C_BRANCH C_BRANCH,
                       C_TEMPLATECODE C_TEMPLATECODE '
);
END;

*/
--4
---OPTIONALLY SYNCHRONIZE NEW TABLE WITH INTERIM DATA BEFORE INDEX CREATION  
--IF THERE IS DELAY BETWEEN THE COMPLETION OF THE PREVIOUS OPERATION AND MOVING ON TO FINISH THE REDEFINITION, 
--IT MAY BE SENSIBLE TO RESYNCHRONIZE THE INTERIM TABLE BEFORE BUILDING ANY CONSTRAINTS AND INDEXES
-- COST DEPENDS ON NUMBER OF NEW RECORD

BEGIN
  dbms_redefinition.sync_interim_table(
    uname      => 'FCB',      
    orig_table => 'T_GENERALLOG',
    int_table  => 'T_GENERALLOG_TP');
END;


--5
---CREATE CONSTRAINTS AND INDEXES
---THE CONSTRAINTS AND INDEXES FROM THE ORIGINAL TABLE MUST BE APPLIED TO INTERIM TABLE USING ALTERNATE NAMES TO PREVENT ERRORS.

-- A
-- PRIMARY KEY 

--->CREATE PK  ON HASH PARTITION -----> 8 MINUTE
CREATE UNIQUE INDEX FCB.PK_T_GENERALLOG_TP ON FCB.T_GENERALLOG_TP (ID)
GLOBAL PARTITION BY HASH (ID)
(
 PARTITION  GENLOG_PK_GPI_1 , 
 PARTITION  GENLOG_PK_GPI_2 ,
 PARTITION  GENLOG_PK_GPI_3 ,
 PARTITION  GENLOG_PK_GPI_4 
 )
 TABLESPACE FCB_TBL  PARALLEL;
   
ALTER TABLE FCB.T_GENERALLOG_TP ADD  CONSTRAINT PK_T_GENERALLOG_TP
 PRIMARY KEY (ID)
    USING INDEX 
    TABLESPACE FCB_TBL 
    
-- B
--INDEXS

---INDEX 1
--- CREATE THIS INDEX INVISIBLE  NOW ----->  6 MINUTE 
CREATE INDEX FCB.GENLOG_TP_BRANCHCODE_IX ON FCB.T_GENERALLOG_TP
(C_BRANCHCODE)
INVISIBLE
TABLESPACE FCB_INX
PARALLEL


---INDEX 2
--- CREATE THIS INDEX  NORMAL ----->  6 MINUTE 
CREATE INDEX FCB.GENLLOG_TP_CURRENCYCODE_IX ON FCB.T_GENERALLOG_TP
(C_CURRENCYCODE)
TABLESPACE FCB_INX
PARALLEL

---INDEX 3
--- CREATE THIS INDEX  LOCAL PARTITION ----->  6 MINUTE

CREATE INDEX FCB.GEALLOG_TP_DATE_LPIX ON FCB.T_GENERALLOG_TP
(C_DATE) LOCAL
TABLESPACE FCB_INX
PARALLEL

---INDEX 4
--- CREATE THIS INDEX  NORMAL ----->  14 MINUTE

CREATE INDEX FCB.GENLOG_TP_TRANSACTIONCODE_IX ON FCB.T_GENERALLOG_TP
(C_TRANSACTIONCODE)
TABLESPACE FCB_INX
PARALLEL

---INDEX 5
--- CREATE THIS INDEX  NORMAL ----->  7  MINUTE
CREATE INDEX FCB.GENLLOG_TP_USERCODE_IX ON FCB.T_GENERALLOG_TP
(C_USERCODE)
TABLESPACE FCB_INX
PARALLEL

---INDEX 6
--- CREATE THIS INDEX  LOCAL PARTITION -----> 9 MINUTE
CREATE INDEX FCB.GENLOG_TP_AMARSEPORDE_LPIX ON FCB.T_GENERALLOG_TP
(C_BRANCHCODE, C_DATE, C_CURRENCYNAME, ID) LOCAL
TABLESPACE FCB_INX
PARALLEL


              
-- 7
------COMPLETE THE REDEFINTION PROCESS

BEGIN
  dbms_redefinition.finish_redef_table(
    uname      => 'FCB',      
    orig_table => 'T_GENERALLOG',
    int_table  => 'T_GENERALLOG_TP');
END;



--- C
-- ----**** TABLES THAT REFERENCES TO T_GENERALLOG 
---


/*
 
 
 
--------------------CREATE



----CHILD ---
BEGIN
FOR  CUR IN (
SELECT       'ALTER TABLE ' || CC.OWNER || '.'|| CC.TABLE_NAME|| ' ADD( '|| CHR(10)|| ' CONSTRAINT  ' || C.CONSTRAINT_NAME || '  FOREIGN KEY ( ' || CC.COLUMN_NAME || ') '||  CHR(10) 
                       || ' REFERENCES ' || CCC.OWNER || '.'|| CCC.TABLE_NAME || ' (' || CCC.COLUMN_NAME || ') '||CHR(10)  
                        || DECODE (C.DELETE_RULE, 'CASCADE', ' ON DELETE CASCADE ', ' ')
                 || '  '|| DECODE (C.STATUS, 'ENABLED', 'ENABLE', 'DISABLE') || ' NOVALIDATE )' ||';' ||CHR(10)||CHR(10)    AS SQLSTR2 
  FROM DBA_CONSTRAINTS C
       INNER JOIN DBA_CONS_COLUMNS CC
          ON C.CONSTRAINT_NAME = CC.CONSTRAINT_NAME AND C.OWNER = CC.OWNER
       INNER JOIN DBA_CONS_COLUMNS CCC
          ON     C.R_CONSTRAINT_NAME = CCC.CONSTRAINT_NAME
             AND CCC.OWNER = C.OWNER
             AND CC.POSITION = CCC.POSITION
 WHERE C.TABLE_NAME = 'T_CHEQUE' AND C.OWNER = 'FCB' AND C.CONSTRAINT_TYPE = 'R' ) LOOP
   DBMS_OUTPUT.PUT_LINE (CUR.SQLSTR2);
  END LOOP;
 END;


--PARENT 

BEGIN 
FOR CUR IN (
  
          select     'ALTER TABLE ' || CC.OWNER || '.'|| CC.TABLE_NAME|| ' ADD( '|| CHR(10)|| ' CONSTRAINT  ' || C.CONSTRAINT_NAME || '  FOREIGN KEY ( ' || CC.COLUMN_NAME || ') '||  CHR(10) 
                       || ' REFERENCES ' || CCC.OWNER || '.'|| CCC.TABLE_NAME || ' (' || CCC.COLUMN_NAME || ') '||CHR(10)  
                        || DECODE (C.DELETE_RULE, 'CASCADE', ' ON DELETE CASCADE ', ' ')
                 || '  '|| DECODE (C.STATUS, 'ENABLED', 'ENABLE', 'DISABLE') || ' NOVALIDATE )' ||';' ||CHR(10)||CHR(10)    AS SQLSTR2 
  FROM DBA_CONSTRAINTS C
 INNER JOIN DBA_CONS_COLUMNS CC ON C.CONSTRAINT_NAME = CC.CONSTRAINT_NAME  AND C.OWNER=CC.OWNER
 INNER JOIN DBA_CONS_COLUMNS CCC ON C.R_CONSTRAINT_NAME = CCC.CONSTRAINT_NAME AND CCC.OWNER=C.OWNER
                                AND CC.POSITION = CCC.POSITION
 WHERE Ccc.TABLE_NAME = 'T_CHEQUE'  AND ccc.OWNER='FCB' AND C.CONSTRAINT_TYPE = 'R' ) LOOP
 
   
 DBMS_OUTPUT.PUT_LINE (CUR.SQLSTR2);
  END LOOP;
 END;
_CONSTRAINT_NAME=CCC.CONSTRAINT_NAME  -->

  */
  

--REF 1

ALTER TABLE   FCB.T_DELETEDFROMPARTNERSHIPDO ADD(                               
 CONSTRAINT  FK_DELFRMPARSHDO_GENLOG_TP  FOREIGN KEY ( ID)                             
 REFERENCES FCB.T_GENERALLOG_TP (ID)                                               
 ON DELETE CASCADE   ENABLE NOVALIDATE )

--REF 2                                                                                
--THIS FK MUST BE VALIDATE FOR REFRNACE PARTITIONING ----> 5 MINUTE
ALTER TABLE   FCB.T_DEPOSITLOG ADD(                                             
 CONSTRAINT  FK_DEPOSITLOG_GENLOG_TP  FOREIGN KEY ( ID)                              
 REFERENCES FCB.T_GENERALLOG_TP (ID)                                               
 ON DELETE CASCADE   ENABLE  )
 
 --REF 3

ALTER TABLE   FCB.T_PASSBOOKLOG ADD(                                            
 CONSTRAINT  FK_PASBOOKLOG_GENLOG_TP  FOREIGN KEY ( ID)                              
 REFERENCES FCB.T_GENERALLOG_TP (ID)                                               
 ON DELETE CASCADE   ENABLE NOVALIDATE )                                        


--REF 4 

ALTER TABLE   FCB.T_PARTNERSHIPDOCUMENTLOG ADD(                                 
CONSTRAINT  FK_PARTSHIPDOCLOG_GENLOG_TP  FOREIGN KEY ( ID)                              
REFERENCES FCB.T_GENERALLOG_TP (ID)                                               
ON DELETE CASCADE   ENABLE NOVALIDATE ) 
 
 
---REF 5

ALTER TABLE   FCB.T_PARTNERSHIPDOCUMENTBLACK ADD(                               
 CONSTRAINT  FK_PARTSHIPDOCBLK_GENLOG_TP  FOREIGN KEY ( ID)                              
 REFERENCES FCB.T_GENERALLOG_TP (ID)                                               
 ON DELETE CASCADE   ENABLE NOVALIDATE )
                                         
--REF 6
ALTER TABLE   FCB.T_TRANSFERMONEYLOG ADD(                                       
 CONSTRAINT  FK_TRANSFMONLOG_GENLOG_TP  FOREIGN KEY ( C_LOG)                                 
 REFERENCES FCB.T_GENERALLOG_TP (ID)                                               
  DISABLE NOVALIDATE ) 



-- 8                                                                                
---CHECK THE PARTITIONING VALIDATION 

SELECT PARTITION_NAME, HIGH_VALUE FROM DBA_TAB_PARTITIONS WHERE TABLE_NAME='T_GENERALLOG';

SELECT SEGMENT_NAME,
  SUM(BYTES)/(1024*1024) SIZEOFTBL,
  PARTITION_NAME
FROM DBA_SEGMENTS
WHERE SEGMENT_TYPE IN( 'TABLE','TABLE PARTITION' ,'TABLE SUBPARTITION')
AND SEGMENT_NAME    =UPPER('T_GENERALLOG')
GROUP BY SEGMENT_NAME,
  PARTITION_NAME
HAVING SUM(BYTES)/(1024*1024) >500

SELECT SEGMENT_NAME,SUM( BYTES)/(1024*1024*1024) SIZEOFTBL --20.5678711
FROM DBA_SEGMENTS
WHERE  SEGMENT_NAME    =UPPER('T_GENERALLOG')
GROUP BY SEGMENT_NAME

SELECT INDEX_NAME , STATUS FROM DBA_INDEXES WHERE TABLE_NAME='T_GENERALLOG'

-- 9
-- REMOVE ORIGINAL TABLE WHICH NOW HAS THE NAME OF THE INTERIM TABLE

--ALTER TABLE FCB.T_GENERALLOG_TP
 --DROP PRIMARY KEY CASCADE

--DROP TABLE  T_GENERALLOG_TP

--- 10 
 --RENAME ALL THE CONSTRAINTS AND INDEXES TO MATCH THE ORIGINAL NAMES

--SELECT  'ALTER INDEX FCB.' ||INDEX_NAME || '  RENAME TO  ' || REPLACE(INDEX_NAME,'_TP','') FROM DBA_INDEXES WHERE TABLE_NAME ='T_GENERALLOG' 
--A INDEX
ALTER INDEX FCB.PK_T_GENERALLOG_TP  RENAME TO PK_T_GENERALLOG --After drop real table must be done    
ALTER INDEX FCB.GENLOG_TP_BRANCHCODE_IX  RENAME TO GENLOG_BRANCHCODE_IX 
ALTER INDEX FCB.GENLLOG_TP_CURRENCYCODE_IX  RENAME TO GENLLOG_CURRENCYCODE_IX                                                                               
ALTER INDEX FCB.GEALLOG_TP_DATE_LPIX  RENAME TO GEALLOG_DATE_LPIX           
ALTER INDEX FCB.GENLOG_TP_TRANSACTIONCODE_IX  RENAME TO GENLOG_TRANSACTIONCODE_IX                                                                           
ALTER INDEX FCB.GENLLOG_TP_USERCODE_IX  RENAME TO GENLLOG_USERCODE_IX       
ALTER INDEX FCB.GENLOG_TP_AMARSEPORDE_LPIX  RENAME TO GENLOG_AMARSEPORDE_LPIX      

--B PRIMARY KEY

ALTER TABLE FCB.T_GENERALLOG RENAME CONSTRAINT  PK_T_GENERALLOG_TP TO PK_T_GENERALLOG --After drop real table must be done    


--C  REFERENC TO T_GENERALLOG (CHILD TABLES)

/* 
SELECT  'ALTER TABLE   FCB.'|| CC.TABLE_NAME|| '  RENAME  CONSTRAINT  ' ||C.CONSTRAINT_NAME ||'  TO ' || REPLACE (C.CONSTRAINT_NAME,'_TP','')
 FROM DBA_CONSTRAINTS C
 INNER JOIN DBA_CONS_COLUMNS CC ON C.CONSTRAINT_NAME = CC.CONSTRAINT_NAME
 INNER JOIN DBA_CONS_COLUMNS CCC ON C.R_CONSTRAINT_NAME = CCC.CONSTRAINT_NAME  AND CC.POSITION = CCC.POSITION
 WHERE CCC.TABLE_NAME = 'T_GENERALLOG' AND C.CONSTRAINT_TYPE = 'R' 
*/ 

ALTER TABLE   FCB.T_TRANSFERMONEYLOG  RENAME  CONSTRAINT  FK_TRANSFMONLOG_GENLOG_TP  TO FK_TRANSFMONLOG_GENLOG;
ALTER TABLE   FCB.T_PARTNERSHIPDOCUMENTBLACK  RENAME  CONSTRAINT  FK_PARTSHIPDOCBLK_GENLOG_TP  TO FK_PARTSHIPDOCBLK_GENLOG;
ALTER TABLE   FCB.T_PARTNERSHIPDOCUMENTLOG  RENAME  CONSTRAINT  FK_PARTSHIPDOCLOG_GENLOG_TP  TO FK_PARTSHIPDOCLOG_GENLOG;
ALTER TABLE   FCB.T_PASSBOOKLOG  RENAME  CONSTRAINT  FK_PASBOOKLOG_GENLOG_TP  TO FK_PASBOOKLOG_GENLOG;
ALTER TABLE   FCB.T_DELETEDFROMPARTNERSHIPDO  RENAME  CONSTRAINT  FK_DELFRMPARSHDO_GENLOG_TP  TO FK_DELFRMPARSHDO_GENLOG;
ALTER TABLE   FCB.T_DEPOSITLOG  RENAME  CONSTRAINT  FK_DEPOSITLOG_GENLOG_TP  TO FK_DEPOSITLOG_GENLOG;

                                            
----------------------------------------------------------------------------------------------
--EB: we must remove ref to old table and fk from old table
---------------------------------------------------------------------------------------------
--REF
SELECT  'alter table fcb.' || CC.TABLE_NAME || ' disable constraint ' || C.CONSTRAINT_NAME || ';'
 FROM DBA_CONSTRAINTS C
 INNER JOIN DBA_CONS_COLUMNS CC ON C.CONSTRAINT_NAME = CC.CONSTRAINT_NAME
 INNER JOIN DBA_CONS_COLUMNS CCC ON C.R_CONSTRAINT_NAME = CCC.CONSTRAINT_NAME  AND CC.POSITION = CCC.POSITION
 WHERE CCC.TABLE_NAME = 'T_GENERALLOG_TP' AND C.CONSTRAINT_TYPE = 'R'

--fk
 SELECT  'alter table fcb.' || CC.TABLE_NAME || ' disable constraint ' || C.CONSTRAINT_NAME || ';'
 FROM DBA_CONSTRAINTS C
 INNER JOIN DBA_CONS_COLUMNS CC ON C.CONSTRAINT_NAME = CC.CONSTRAINT_NAME
 INNER JOIN DBA_CONS_COLUMNS CCC ON C.R_CONSTRAINT_NAME = CCC.CONSTRAINT_NAME  AND CC.POSITION = CCC.POSITION
 WHERE CC.TABLE_NAME = 'T_GENERALLOG_TP' AND C.CONSTRAINT_TYPE = 'R'

